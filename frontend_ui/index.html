<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–µ–ª—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 2rem;
            background-color: #f9f9f9;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        }
        .card {
            width: 70%;
            max-width: 1200px;
            margin: auto;
            box-shadow: 0 0.25rem 1rem rgba(0, 0, 0, 0.05);
        }
        .card-small {
            width: 50%;
            max-width: 800px;
            margin: auto;
            box-shadow: 0 0.25rem 1rem rgba(0, 0, 0, 0.05);
        }
        .card, .card-small {
           background: #fff;
           border-radius: 16px;
           border: 1px solid #eef1f6;
        }
        h3 {
            text-align: center;
        }
        #chartContainer {
            height: 420px;
            width: 100%;
            position: relative;
        }

        #forecastChart {
            width: 100% !important;
            height: 100% !important;
        }
        .hidden { display: none; }
        .muted { color: #6c757d; font-size: .95rem; }
        .row-gap { row-gap: 12px; }
        .code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;  padding: 6px}
    </style>
</head>
<body>

<div class="container">
    <!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
    <div id="loginSection" class="card-small p-4 mb-4">
        <h3 class="mb-3">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h3>

        <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" id="email" class="form-control" placeholder="name@example.com" autocomplete="username"/>
        </div>

        <div class="mb-3">
            <label for="password" class="form-label">–ü–∞—Ä–æ–ª—å</label>
            <input type="password" id="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                   autocomplete="current-password"/>
        </div>

        <button class="btn btn-primary w-100" id="btnLogin">–í–æ–π—Ç–∏</button>
    </div>

    <!-- –ì–ª–∞–≤–Ω–∞—è —Å–µ–∫—Ü–∏—è -->
    <div id="mainSection" class="card p-4 hidden">
        <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
            <h3 class="m-0">–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø—Ä–æ—Å–∞</h3>
            <div class="d-flex gap-2">
                <button class="btn btn-outline-secondary" id="btnReloadMe">–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
                <button class="btn btn-outline-danger" id="btnLogout">–í—ã–π—Ç–∏</button>
            </div>
        </div>


        <!-- Profile / hotel context -->
        <div class="border rounded-3 p-3 mb-4">
            <div class="row row-gap">
                <div class="col-12 col-lg-7">
                    <label for="hotelSelect" class="muted">–û—Ç–µ–ª—å –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π</label>
                    <select id="hotelSelect" class="form-select"></select>
                </div>
                <div class="col-12 col-lg-5">
                    <div class="muted">–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                    <div id="meInfo" class="code"></div>
                </div>
            </div>
        </div>

        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ -->
        <div class="mb-3">
            <label for="csvFile" class="form-label">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π (CSV):</label>
            <input class="form-control" type="file" id="csvFile" accept=".csv">
        </div>
        <button class="btn btn-outline-primary w-100 mb-3" id="btnUpload">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>


        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≥–Ω–æ–∑–∞ -->
        <div class="mb-3">
            <label for="forecastDate" class="form-label">–î–∞—Ç–∞, –æ—Ç –∫–æ—Ç–æ—Ä–æ–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–æ–≥–Ω–æ–∑:</label>
            <input type="date" id="forecastDate" class="form-control" max="">
        </div>
        <div class="mb-3">
            <label class="form-label">–ì–æ—Ä–∏–∑–æ–Ω—Ç –ø—Ä–æ–≥–Ω–æ–∑–∞:</label>
            <select id="horizon" class="form-select">
                <option value="30">1‚Äì30 –¥–Ω–µ–π</option>
                <option value="7">1‚Äì7 –¥–Ω–µ–π</option>
                <option value="0">–¢–æ–ª—å–∫–æ –∏—Å—Ç–æ—Ä–∏—è</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">–ù–∞–ª–∏—á–∏–µ –¥–µ–ø–æ–∑–∏—Ç–∞:</label>
            <select id="deposit" class="form-select">
                <option value="false">–ù–µ—Ç –¥–µ–ø–æ–∑–∏—Ç–∞</option>
                <option value="true">–ï—Å—Ç—å –¥–µ–ø–æ–∑–∏—Ç</option>
            </select>
        </div>

        <button class="btn btn-primary w-100 mb-3" id="btnFetchForecast">–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑</button>

        <!-- –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ -->
        <div class="mb-3">
            <label class="form-label">–§–æ—Ä–º–∞—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
            <select id="displayMode" class="form-select">
                <option value="chart">–ì—Ä–∞—Ñ–∏–∫</option>
                <option value="table">–¢–∞–±–ª–∏—Ü–∞</option>
            </select>
        </div>

        <button class="btn btn-primary w-100 mb-4" id="btnRender">–û—Ç–æ–±—Ä–∞–∑–∏—Ç—å</button>

        <div id="chartContainer" class="mb-4">
            <canvas id="forecastChart"></canvas>
        </div>

        <div id="tableContainer" class="hidden">
            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–°–ø—Ä–æ—Å</th>
                        <th>–û—Ç–º–µ–Ω—ã</th>
                        <th>–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø—Ä–æ—Å</th>
                        <th>–ò—Å—Ç–æ—Ä–∏—è/–ü—Ä–æ–≥–Ω–æ–∑</th>
                    </tr>
                    </thead>
                    <tbody id="forecastTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const API_BASE_URL = "http://localhost:8001";

    let lastForecast = null;
    let chartInstance = null;

    let refreshInProgress = false;
    let refreshPromise = null;

     function setTodayToDateInput() {
        const today = new Date().toISOString().split('T')[0];
        const dateInput = document.getElementById("forecastDate");
        dateInput.value = today;
        dateInput.max = today;
     }

     // === Error parsing (shared.errors contract) ===
     async function safeJson(response) {
         try {
             return await response.json();
         } catch {
             return null;
         }
     }

     function handleLogout() {
         alert("–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.");
         setAuthUI(false);
         lastForecast = null;
         destroyChart();
         clearTable();
     }

     function extractError(payload) {
        // –ø–æ–¥–¥–µ—Ä–∂–∏–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: {"error": {...}} –∏ {"type": "...", ...}
        if (!payload) return null;
        if (payload.error && typeof payload.error === "object") return payload.error;
        if (payload.type) return payload;
        return null;
     }

     function showErrorToUser(err) {
         if (!err) {
             alert("‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞");
             return;
         }
         const type = err.type || "unknown_error";
         const message = err.message || "–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞"
         switch (type) {
             case "AuthorizationError":
                 alert("üîí –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è.");
                 break;
             case "CSVProcessingError":
                 alert(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ CSV: ${message}`);
                 break;
            case "MappingError":
                alert(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –º–∞–ø–ø–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö: ${message}`);
                break;
            case "ConflictError":
                alert(`‚ÑπÔ∏è –ö–æ–Ω—Ñ–ª–∏–∫—Ç –¥–∞–Ω–Ω—ã—Ö: ${message}`);
                break;
            case "NoForecastError":
                warningDiv.textContent = "üì≠ –ü—Ä–æ–≥–Ω–æ–∑ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞.";
                break;
            case "InsufficientHistoryError":
                warningDiv.textContent = "‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞.";
                break;
            case "DatabaseError":
                warningDiv.textContent = "üíæ –û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø—Ä–æ–≥–Ω–æ–∑–∞.";
                break;
            default:
                alert(`‚ùó ${message}`);
         }
     }

    async function apiFetch(path, options = {}, { retryOn401 = true } = {}) {
        const doRequest = () =>
            fetch(`${API_BASE_URL}${path}`, {
                ...options,
                credentials: "include",
            });

        let response = await doRequest();

        if (response.status !== 401 || !retryOn401) {
            return response;
        }

        const refreshed = await tryRefresh();

        if (!refreshed) {
            handleLogout();
            throw new Error("Unauthorized");
        }

        return doRequest();
    }

    function getSelectedHotelId() {
        const value = document.getElementById("hotelSelect").value;
        if (!value) return null;
        const id = Number(value);
        return Number.isFinite(id) ? id : null;
    }

    function setAuthUI(isAuthed) {
        document.getElementById("loginSection").classList.toggle("hidden", isAuthed);
        document.getElementById("mainSection").classList.toggle("hidden", !isAuthed);
    }

    async function loadMe() {
        // –ù—É–∂–µ–Ω proxy endpoint –Ω–∞ gateway: GET /auth/me
        const resp = await apiFetch("/auth/me", { method: "GET" });
        const me = await resp.json();

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const meInfo = document.getElementById("meInfo");
        const userId = me.sub ?? me.user_id ?? "?";
        const role = me.role ?? me.system_role ?? "?";
        meInfo.textContent = `user_id=${userId} role=${role}`;

        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ—Ç–µ–ª–µ–π
        const hotels = me.hotels || [];
        const select = document.getElementById("hotelSelect");
        select.innerHTML = "";

        if (!Array.isArray(hotels) || hotels.length === 0) {
            const opt = document.createElement("option");
            opt.value = "";
            opt.textContent = "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ—Ç–µ–ª–µ–π";
            select.appendChild(opt);
            select.disabled = true;
            return;
        }

        hotels.forEach(h => {
            const opt = document.createElement("option");
            opt.value = String(h.id);
            const roleText = h.user_role ?? h.role ?? "";
            opt.textContent = roleText ? `–û—Ç–µ–ª—å #${h.id} (${roleText})` : `–û—Ç–µ–ª—å #${h.id}`;
            select.appendChild(opt);
        });

        select.disabled = false;
    }

    // === AUTH: login/logout ===
    async function login() {
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;

        if (!email || !password) {
            alert("–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å.");
            return;
        }

        try {
            await apiFetch("/auth/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password }),
            });

            setAuthUI(true);
            await loadMe();
            alert("‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω.");
        } catch (e) {
            showErrorToUser(e._serviceError);
            console.error(e);
        }
    }

    async function tryRefresh() {
        if (refreshInProgress) {
            return refreshPromise;
        }

        refreshInProgress = true;
        refreshPromise = fetch(`${API_BASE_URL}/auth/refresh`, {
            method: "POST",
            credentials: "include"
        })
            .then(res => res.ok)
            .catch(() => false)
            .finally(() => {
                refreshInProgress = false;
            });

        return refreshPromise;
    }

    async function logout() {
        try {
            await apiFetch("/auth/logout", { method: "POST" }, { retryOn401: false });
        } catch (e) {
            // –µ—Å–ª–∏ logout –Ω–µ –ø—Ä–æ—à—ë–ª, –≤—Å—ë —Ä–∞–≤–Ω–æ —Å—á–∏—Ç–∞–µ–º —Å–µ—Å—Å–∏—é –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ
            console.warn("Logout failed:", e);
        } finally {
            setAuthUI(false);
            lastForecast = null;
            destroyChart();
            clearTable();
        }
    }

    // === CSV upload ===
    async function uploadCSV() {
        const fileInput = document.getElementById("csvFile");
        const file = fileInput.files?.[0];
        if (!file) {
            alert("–í—ã–±–µ—Ä–∏—Ç–µ CSV —Ñ–∞–π–ª.");
            return;
        }

        const hotelId = getSelectedHotelId();
        if (!hotelId) {
            alert("–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–µ–ª—å.");
            return;
        }

        const formData = new FormData();
        formData.append("file", file);

        try {
            const resp = await apiFetch("/data/import-bookings", {
                method: "POST",
                headers: { "X-Hotel-Id": String(hotelId) },
                body: formData,
            });
            const result = await resp.json();
            alert(`‚úÖ –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω. –î–æ–±–∞–≤–ª–µ–Ω–æ: ${result.added ?? "?"}, –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø—Ä–æ–ø—É—â–µ–Ω–æ: ${result.duplicates_skipped ?? "?"}`);
        } catch (e) {
            showErrorToUser(e._serviceError);
            console.error(e);
        }
    }

    // === Forecast fetch ===
    async function fetchForecast() {
        const hotelId = getSelectedHotelId();
        if (!hotelId) {
            alert("–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–µ–ª—å.");
            return;
        }

        const payload = {
            target_date: document.getElementById("forecastDate").value,
            horizon: Number(document.getElementById("horizon").value),
            has_deposit: document.getElementById("deposit").value === "true",
            history_window: 30,
        };

        try {
            const resp = await apiFetch("/data/fetch-forecast", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-Hotel-Id": String(hotelId),
                },
                body: JSON.stringify(payload),
            });

            lastForecast = await resp.json();
            alert("‚úÖ –ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–ª—É—á–µ–Ω.");
        } catch (e) {
            showErrorToUser(e._serviceError);
            console.error(e);
        }
    }

    // === Rendering ===
    function renderForecast() {
        if (!lastForecast) {
            alert("–°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç–µ –ø—Ä–æ–≥–Ω–æ–∑.");
            return;
        }

        const mode = document.getElementById("displayMode").value;
        if (mode === "chart") {
            document.getElementById("chartContainer").classList.remove("hidden");
            document.getElementById("tableContainer").classList.add("hidden");
            renderChart(lastForecast);
        } else {
            document.getElementById("chartContainer").classList.add("hidden");
            document.getElementById("tableContainer").classList.remove("hidden");
            renderTable(lastForecast);
        }
    }

    function destroyChart() {
        if (chartInstance) {
            chartInstance.destroy();
            chartInstance = null;
        }
    }

    function clearTable() {
        document.getElementById("forecastTableBody").innerHTML = "";
    }

    function normalizeForecastData(payload) {
        const history = payload?.history_summary ?? [];
        const forecast = payload?.forecast ?? [];

        const mapRow = (r, kind) => ({
            day: r.day,
            bookings: r.bookings ?? 0,
            cancellations: r.cancellations ?? 0,
            adjusted: (r.bookings ?? 0) - (r.cancellations ?? 0),
            kind,
        });

        return [
            ...history.map(r => mapRow(r, "history")),
            ...forecast.map(r => mapRow(r, "forecast")),
        ];
    }

    function kindLabel(kind) {
        if (kind === "history") return "–ò—Å—Ç–æ—Ä–∏—è";
        if (kind === "forecast") return "–ü—Ä–æ–≥–Ω–æ–∑";
        return "";
    }

    function renderChart(payload) {
        const rows = normalizeForecastData(payload);
        if (!rows.length) {
            alert("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è");
            return;
        }

        const ctx = document.getElementById("forecastChart").getContext("2d");

        if (window.chartInstance) {
            window.chartInstance.destroy();
        }

        const labels = rows.map(r => r.day);
        const bookings = rows.map(r => r.bookings);
        const cancellations = rows.map(r => r.cancellations);
        const adjustedDemand = rows.map(r => r.adjusted);

        const horizonValue = document.getElementById("horizon").value;
        const isHistoryOnly = horizonValue === "0";

        const backgroundBookings = rows.map(r => {
            if (isHistoryOnly) return "rgba(65,134,243,0.6)";
            return r.kind === "history"
                ? "rgba(65,134,243,0.25)"
                : "rgba(65,134,243,0.7)";
        });

        const backgroundCancellations = rows.map(r => {
            if (isHistoryOnly) return "rgba(255,99,132,0.6)";
            return r.kind === "history"
                ? "rgba(255,99,132,0.25)"
                : "rgba(255,99,132,0.7)";
        });

        window.chartInstance = new Chart(ctx, {
            type: "bar",
            data: {
                labels,
                datasets: [
                    {
                        label: "–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è",
                        data: bookings,
                        backgroundColor: backgroundBookings,
                        stack: "stack1",
                    },
                    {
                        label: "–û—Ç–º–µ–Ω—ã",
                        data: cancellations,
                        backgroundColor: backgroundCancellations,
                        stack: "stack1",
                    },
                    {
                        label: "–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø—Ä–æ—Å",
                        data: adjustedDemand,
                        type: "line",
                        borderColor: "black",
                        borderWidth: 2,
                        pointRadius: 2,
                        tension: 0.25,
                        fill: false,
                        order: 99,
                    },
                ],
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        stacked: true,
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45,
                        },
                    },
                    y: {
                        stacked: true,
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ",
                        },
                    },
                },
                plugins: {
                    legend: {
                        position: "top",
                    },
                    tooltip: {
                        mode: "index",
                        intersect: false,
                    },
                },
            },
        });
    }

    function renderTable(payload) {
        const rows = normalizeForecastData(payload);

        if (rows.length === 0) {
            alert("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.");
            return;
        }

        const tbody = document.getElementById("forecastTableBody");
        tbody.innerHTML = "";

        rows.forEach(r => {
            const tr = document.createElement("tr");

            tr.innerHTML = `
                <td>${r.day ?? ""}</td>
                <td>${r.bookings}</td>
                <td>${r.cancellations}</td>
                <td>${r.adjusted}</td>
                <td>${kindLabel(r.kind)}</td>
            `;

            tbody.appendChild(tr);
        });
    }

    // === Event wiring ===
    window.onload = () => {
        setTodayToDateInput();

        document.getElementById("btnLogin").addEventListener("click", login);
        document.getElementById("btnUpload").addEventListener("click", uploadCSV);
        document.getElementById("btnFetchForecast").addEventListener("click", fetchForecast);
        document.getElementById("btnRender").addEventListener("click", renderForecast);
        document.getElementById("btnLogout").addEventListener("click", logout);
        document.getElementById("btnReloadMe").addEventListener("click", async () => {
            try {
                await loadMe();
                alert("‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω.");
            } catch (e) {
                showErrorToUser(e._serviceError);
                console.error(e);
            }
        });

        // –ü–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é:
        // –µ—Å–ª–∏ cookies —É–∂–µ –µ—Å—Ç—å, /auth/me –¥–∞—Å—Ç 200 –∏ –º—ã —Å—Ä–∞–∑—É –ø–æ–∫–∞–∂–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —á–∞—Å—Ç—å.
        (async () => {
            try {
                await loadMe();
                setAuthUI(true);
            } catch {
                setAuthUI(false);
            }
        })();
    };
</script>
</body>
</html>